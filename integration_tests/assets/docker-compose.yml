version: '3.7'
services:
  sync:
    image: wazopbx/wait
    environment:
      TIMEOUT: '${INTEGRATION_TEST_TIMEOUT}'

  chatd:
    image: wazo-chatd-test
    environment:
      XIVO_UUID: 00000000-0000-0000-0000-0000000c4a7d
    volumes:
      - ../..:/usr/src/wazo-chatd:ro
      - ./etc/wazo-chatd/conf.d/50-default.yml:/etc/wazo-chatd/conf.d/50-default.yml:ro
      - ./key-file.yml:/tmp/key-file.yml:ro
      # - '${LOCAL_GIT_REPOS}/xivo-lib-python/xivo:/usr/local/lib/python3.5/site-packages/xivo'
      # - '${LOCAL_GIT_REPOS}/xivo-bus/xivo_bus:/usr/local/lib/python3.5/site-packages/xivo_bus'
      # - '${LOCAL_GIT_REPOS}/xivo-auth-client/xivo_auth_client:/usr/local/lib/python3.5/site-packages/xivo_auth_client'
      # - '${LOCAL_GIT_REPOS}/xivo-confd-client/xivo_confd_client:/usr/local/lib/python3.5/site-packages/xivo_confd_client'
    ports:
      - '9304'

  auth:
    image: wazopbx/wazo-auth-mock
    ports:
      - '9497'

  postgres:
    image: wazopbx/wazo-chatd-db
    ports:
      - "5432"

  amid:
    image: wazopbx/xivo-amid-mock
    ports:
      - 9491

  confd:
    image: wazopbx/xivo-confd-mock
    ports:
      - 9486

  rabbitmq:
    image: rabbitmq
    ports:
      - '5672'
    volumes:
      - type: tmpfs
        target: /var/lib/rabbitmq
